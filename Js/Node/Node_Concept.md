# Что такое Node.js

---

## 1. Что такое Node.js на самом деле?

**Node.js — это не язык, не фреймворк и не библиотека.**

**Node.js — это среда выполнения (Runtime Environment).**

Представь, что JavaScript — это топливо (код).
Раньше это топливо могло гореть только в одном типе двигателей — в **браузерах** (Chrome, Firefox).
Node.js — это тот момент, когда инженеры взяли двигатель от гоночного болида (движок **V8** из Google Chrome), вытащили его из машины (браузера) и поставили на заводской станок (сервер).

Теперь JavaScript может управлять не только анимацией на сайте, но и файлами, базами данных и сетевыми запросами на компьютере.

**Зачем это нужно?**
1.  **Backend разработка:** Создание серверов, API, работа с базой данных (вместо Python/Java/PHP).
2.  **Скрипты автоматизации:** Написание утилит для работы с файловой системой (аналог bash/python скриптов).
3.  **Инструменты разработки (Tooling):** Все современные фронтенд-инструменты (Webpack, Vite, ESLint, Prettier) работают на Node.js.

### Ключевая формула:
> **Node.js = Движок V8 (JS в машинный код) + Libuv (работа с файлами/сетью асинхронно)**

---

## 2. Как Node.js работает с зависимостями

В Node.js изоляция зависимостей **встроена изначально**. Когда ты пишешь `npm install react`, Node.js **не** ставит это в систему. Он создает папку `node_modules` прямо внутри твоего проекта.

*   Проект А имеет свою папку `node_modules` с React v16.
*   Проект Б имеет свою папку `node_modules` с React v18.

**Каждый проект — это уже, по сути, своё изолированное окружение.**

### Как это работает:
1. У тебя есть **ОДИН** системный Node.js (или управляемый через nvm).
2. Ты просто заходишь в папку проекта.
3. Node.js автоматически видит папку `node_modules` рядом с кодом и берёт зависимости оттуда.
4. Ничего "активировать" не нужно. Логика поиска зависимостей ("Node Resolution Algorithm") сама ищет папку `node_modules` в текущей директории и выше.

---

## 3. Управление версиями Node.js

> **Важно:** Не путай **менеджеры версий** и **менеджеры пакетов** — это разные вещи!

```
┌──────────────────────────┬────────────────────────────────────────────────────┐
│ Менеджеры версий         │ Управляют версией самого Node.js                   │
│ (nvm, fnm, volta)        │ "Какой движок использовать?"                       │
├──────────────────────────┼────────────────────────────────────────────────────┤
│ Менеджеры пакетов        │ Управляют библиотеками проекта                     │
│ (npm, pnpm, yarn)        │ "Какие запчасти поставить в проект?"               │
└──────────────────────────┴────────────────────────────────────────────────────┘
```

Если Проекту А нужна **Node v14**, а Проекту Б — **Node v20**, используются менеджеры версий:

```
┌────────────────────────────────┬───────────────────────────────────────────────┐
│ Инструмент                     │ Описание                                      │
├────────────────────────────────┼───────────────────────────────────────────────┤
│ NVM (Node Version Manager)     │ Классический менеджер версий Node.js          │
├────────────────────────────────┼───────────────────────────────────────────────┤
│ FNM (Fast Node Manager)        │ Быстрая альтернатива NVM                      │
├────────────────────────────────┼───────────────────────────────────────────────┤
│ Volta                          │ Современный менеджер с автопереключением      │
└────────────────────────────────┴───────────────────────────────────────────────┘
```

### Зачем мне это нужно на практике? (Реальные примеры)

Если ты работаешь над своими пет-проектами, у тебя стоит последняя версия Node.js (например, v20), и всё работает. Но в командной разработке возникают ситуации:

#### Ситуация 1: "У меня работает, а у тебя нет"
Ты используешь функцию `crypto.randomUUID()`, которая появилась только в Node v15.6.0.
Твой коллега скачивает проект, но у него стоит старая Node v14 (с прошлого проекта). У него всё падает с ошибкой `TypeError: crypto.randomUUID is not a function`.

> **Решение:** Вы кладете файл `.nvmrc` с текстом `18.17.0` в проект. Теперь все знают, какую версию использовать.

#### Ситуация 2: Старый легаси проект
Тебе нужно пофиксить баг в проекте, который написали 4 года назад. Он использует старые библиотеки, которые **не работают** на новой Node v20 (из-за изменений в API OpenSSL или V8).

> **Без менеджера версий:** Тебе пришлось бы удалять свою Node v20, ставить старую Node v12, фиксить баг, а потом снова переустанавливать Node v20.
> **С менеджером версий:** Ты пишешь `nvm use 12`, фиксишь баг, и пишешь `nvm use 20`. Всё.

#### Ситуация 3: CI/CD (Автодеплой)
Когда ты запускаешь тесты на GitHub Actions, ты должен точно сказать серверу, на какой версии запускать код, чтобы поведение совпадало с локальным.

### Где указывается нужная версия Node.js?

```
┌─────────────────────────┬──────────────────────────────────────────────────────┐
│ Файл                    │ Описание                                             │
├─────────────────────────┼──────────────────────────────────────────────────────┤
│ .nvmrc                  │ Просто номер версии: 18.17.0 или lts/*              │
│                         │ Используется nvm и fnm                               │
├─────────────────────────┼──────────────────────────────────────────────────────┤
│ .node-version           │ Аналог .nvmrc, поддерживается fnm и другими         │
├─────────────────────────┼──────────────────────────────────────────────────────┤
│ package.json            │ Поле "engines": { "node": ">=18.0.0" }              │
│                         │ Volta читает это + своё поле "volta"                 │
└─────────────────────────┴──────────────────────────────────────────────────────┘
```

### Когда происходит переключение версии?

```
┌──────────────┬───────────────────────────────────────────────────────────────┐
│ Инструмент   │ Как работает                                                  │
├──────────────┼───────────────────────────────────────────────────────────────┤
│ nvm          │ ВРУЧНУЮ: нужно выполнить `nvm use` при входе в проект         │
│              │ Или добавить автозагрузку в .zshrc/.bashrc                    │
├──────────────┼───────────────────────────────────────────────────────────────┤
│ fnm          │ АВТОМАТИЧЕСКИ: `fnm use` при cd в папку (если настроено)      │
│              │ Быстрее nvm, написан на Rust                                  │
├──────────────┼───────────────────────────────────────────────────────────────┤
│ volta        │ АВТОМАТИЧЕСКИ: подхватывает версию из package.json           │
│              │ Прозрачно — просто работает, ничего не нужно активировать     │
└──────────────┴───────────────────────────────────────────────────────────────┘
```

**Пример .nvmrc:**
```
18.17.0
```

**Пример package.json с Volta:**
```json
{
  "name": "my-project",
  "volta": {
    "node": "18.17.0",
    "pnpm": "8.6.0"
  }
}
```

---

## 4. Основные компоненты экосистемы

```
┌─────────────────────┬─────────────────────────────────────────────┐
│ Компонент           │ Описание                                    │
├─────────────────────┼─────────────────────────────────────────────┤
│ Node.js             │ Среда выполнения (runtime)                  │
├─────────────────────┼─────────────────────────────────────────────┤
│ npm / pnpm / yarn   │ Менеджеры пакетов                           │
├─────────────────────┼─────────────────────────────────────────────┤
│ node_modules        │ Локальная папка с зависимостями проекта     │
├─────────────────────┼─────────────────────────────────────────────┤
│ package.json        │ Манифест проекта с описанием зависимостей   │
└─────────────────────┴─────────────────────────────────────────────┘
```

---

## Итого

1. **Node.js** — это программа, которая позволяет запускать JavaScript вне браузера.
2. **Изоляция зависимостей** работает "из коробки" — библиотеки ставятся локально в `node_modules`.
3. **Версии Node.js** управляются через nvm/fnm/volta.
